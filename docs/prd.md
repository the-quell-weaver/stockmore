# PrepStock（防災物資庫存管理）PRD（Global Overview）

## 1. 產品背景與問題定義

* 防災物資需要長期維護（採購、存放、到期、補貨），但多數人缺乏簡單易用的管理工具。
* 在緊急情境下，電力/網路可能中斷，因此需要「可離線使用的紙本清單」作為備援。
* 產品要降低推廣阻力：使用者能快速建立/共享一個「家庭/社區倉庫」並在手機上順手維護。

## 2. 目標（Goals）

* 提供一個多租戶的網頁服務：使用者登入後可建立與管理多個「倉庫（Warehouse）」。
* 每個倉庫可由多位成員共同管理，具備基本權限控管（owner/editor/viewer）。

  * 除了「使用者」成員外，也支援「團體（Group）」作為一種成員：團體是一組使用者集合，對外視為單一成員並可被賦予倉庫權限；團體內有管理者可管理團體成員與管理者。
* 倉庫內包含兩個核心清單：

  * 採購列表（待採購）：可記錄品名、單項份量/包裝規格（可選）、數量、使用者自訂類別標籤。
  * 庫存列表（已庫存）：可記錄品名、單項份量/包裝規格（可選）、數量，以及到期日（可選）、存放點、是否開封等。
* 支援從「採購列表 → 庫存列表」的轉換（採購完成後快速入庫），並支援「部分入庫」以貼近實際採買情境。
* 以交易/事件方式保留數量變動紀錄（購買/入庫、消耗、盤點調整），便於追溯與回溯。
* 提供可篩選的總覽介面，協助快速盤點與找出「快到期 / 需替換補充」項目。
* 提供提醒機制：以「到期」為核心提醒（可選 Email 與 iCalendar/ICS 匯出），避免提醒噪音與降低使用門檻。
* 提供可列印的紙本庫存清單（PDF / Print-friendly），做為無網路/無電力時的備援管理方式。
* 提供「滿足單位」機制以支援儲備規劃統計：使用者可自行定義單位種類與意涵，並在物品批次上標註其可貢獻的單位量。
* 手機優先體驗：在手機上能完成新增、入庫、消耗、盤點、查詢等核心操作。

## 3. 非目標（Non-Goals）

非目標（Non-Goals）
非目標（Non-Goals）

* 不做完整 ERP / 複雜採購流程（供應商、報價、採購單、會計等）。
* 不做雲端硬碟或試算表的深度整合（例如 Google Drive/Sheets 雙向同步）作為 MVP 必備。
* 不追求完整離線 Web App（MVP 以紙本輸出與 ICS 匯出作為離線備援；PWA 可列後續）。
* 不做高度自動化決策（例如自動比價、自動下單）；提醒/清單管理為主。

## 4. 目標使用者與使用情境（Who / When）

* 個人/家庭：日常維護防災物資（食物、飲水、醫療、工具等），定期盤點與補貨。
* 社區/團體：共享同一個倉庫，分工管理存放點與補貨責任。
* 典型情境：

  * 採購前：查看採購列表（含數量），確認要買什麼、買多少
  * 採購後：將採購項目轉成庫存項目並補齊到期/存放點/開封狀態
  * 定期盤點：依存放點或類別篩選、列印紙本清單做現場核對
  * 到期/低庫存：收到 Email 或匯出 ICS 後在行事曆被提醒，回到系統更新或補貨

## 5. MVP 範圍（What’s in MVP）

* 帳號與登入：使用者可登入並建立資料（MVP 以 email magic link 或等價方案）。
* 倉庫（Warehouse）

  * 使用者可建立多個倉庫並切換
  * 可邀請其他使用者加入同一倉庫
  * 基本角色/權限（owner/editor/viewer；MVP 不需要更細角色）
  * 也可將「團體（Group）」加入倉庫並賦予權限（團體內所有成員一體適用該權限）
* 團體（Group）

  * 團體是一組使用者集合，對外視為單一成員
  * 團體至少有一名團體管理者；管理者可新增/移除成員並指派更多管理者
* 存放點（可重用；可作廢不可刪除）

  * 倉庫層級維護一份「存放點清單/字典」，每個存放點包含 unique ID 與顯示名稱
  * 存放點可改名（名稱更新會反映於既有庫存顯示）
  * 存放點只能作廢、不能刪除；且若仍有庫存指向該存放點，則不可作廢
  * 被作廢的存放點不可再被新庫存選用，但需保留以供歷史追溯
* 類別標籤（倉庫範圍；可改名/作廢）

  * 採購與庫存共用同一套類別標籤體系
  * 標籤字典以「倉庫」為範圍（未來再考慮分享子集合）
  * 標籤可改名與作廢；紀錄應以標籤 ID 關聯，改名會反映到既有紀錄顯示
  * 作廢標籤：不可再被新物品選用；預設不可用於篩選；既有紀錄不強制更新，但顯示時加註「已作廢」
* 採購列表（待採購；支援交易紀錄）

  * 物資欄位：品名、單項份量/包裝規格（可選）、數量（整數）、類別標籤
  * 支援新增/編輯/（必要時）封存或移除（細節下放 feature）
  * 採購→入庫屬於 transaction：採購列表需保留「轉出」紀錄以便追溯
* 庫存列表（已庫存；支援批次與聚合顯示；支援交易紀錄）

  * 物資欄位：品名、單項份量/包裝規格（可選）、數量、到期日（可選）、存放點（由倉庫字典選擇）、是否開封、類別標籤、滿足單位（可選；批次層級）
  * 數量規則：入庫/採買時不允許小數；消耗與盤點調整允許小數
  * 支援新增/編輯（允許更正輸入錯誤）
  * 同一物品可存在多個「批次」（不同到期日與/或不同存放點與/或不同包裝規格）
  * UI 與紙本皆採「兩層聚合顯示」：

    * 第一層：依品名聚合
    * 第二層：依（包裝規格、到期日、存放點）聚合；使用者可設定需要哪些欄位一致才聚合，以及可省略哪些欄位不顯示（不顯示即不作為區分）
    * 同品名不同包裝規格預設分開；缺少包裝規格者也要與有包裝規格者分開
    * UI 的聚合/顯示設定與紙本輸出的設定可分開
* 入庫轉換流程（採購→庫存；批次建立；部分入庫）

  * 支援將採購項目轉為庫存項目（採購完成後的入庫主流程）
  * 允許「部分入庫」：入庫時需選擇本次入庫數量
  * 一次入庫建立的項目必定共享相同屬性（到期日/存放點/包裝規格等）；若要記錄不同包裝規格，需分開入庫
  * 入庫時可選填到期日、存放點，且允許更新標籤
  * 入庫時更新標籤僅影響「本次入庫生成的庫存項目（批次）」；不回寫採購項目或其他批次
  * 每次入庫操作套用的到期日與存放點需一致；若要輸入不同到期日/存放點，需分開多次入庫（形成多個批次）
* 消耗（出庫）

  * 消耗會以交易/事件方式記錄，並扣減庫存數量（允許小數）。
  * 若使用者操作提供的上下文不足以完全決定批次（到期日/存放點/包裝規格），系統提供預設分配順序並允許覆寫。
  * 預設分配順序（由高到低優先）：

    * 到期日：未指定 > 舊（快到期）> 新（慢到期）
    * 存放點：未指定 > 依入庫順序先入先出
    * 包裝規格：未指定 > 依入庫順序先入先出
* 盤點（調整）

  * 盤點調整以交易/事件方式記錄。
  * 盤點時必須要求使用者手動指定批次。
  * 盤點調整是「直接指定實際數量」；備註欄位可選。
* 庫存轉移（存放點 ID 變更）

  * 若要修改「物品實際放在哪個存放點（由存放點 ID 決定）」屬於交易（轉移/轉帳），應以新增一筆轉移紀錄處理（不可直接改 ID）。
  * 允許更正輸入錯誤：品名、到期日、存放點顯示名稱等可直接修改（具體邊界下放 feature）
* 數量變動（交易追溯）

  * 消耗、購買（入庫）、盤點（調整）都會改變數量
  * 需保留每次數量變動的紀錄以便追蹤
  * 交易/事件紀錄不允許刪除；若填錯，使用者可用後續的盤點/調整或其他交易來修正（等價於沖銷機制）
* 物資總覽與篩選

  * 可依類別/關鍵字/存放點/到期狀態等條件篩選（具體條件下放 feature）
  * 顯示層支援依兩層聚合呈現與展開
  * 可依「滿足單位」彙總統計（例如：乾糧總單位、飲水總單位）以協助儲備達標評估（MVP 先提供彙總；目標值設定留待後續）
* 到期提醒（多批次/聚合語意）

  * 到期提醒以「使用者當下選擇的聚合規則」為準：若多批次被聚合為同一項目則一起提醒；若未聚合則分開提醒。
  * 到期日為空（未填）者永不提醒。
* 提醒通路（MVP 通路；以到期為核心；使用者層級訂閱）

  * Email 提醒可選擇啟用
  * 匯出 iCalendar / ICS（讓使用者匯入行事曆軟體）
  * ICS 匯出方式：每次匯出一份「完整當前清單」供使用者手動匯入/覆蓋（訂閱 URL 留待後續）
  * 提醒訂閱以使用者為主：MVP 先只支援「訂閱到倉庫」
  * 到期日與 ICS 事件以「使用者時區」為準
  * ICS 事件模型：以「到期日當天」為事件發生日，搭配提前提醒；提前量可由使用者設定

    * 預設策略：若距離到期 ≥ 1 個月，則於 1 個月前提醒；若不足 1 個月但 ≥ 1 週，則於 1 週前提醒；若不足 1 週則不提醒
* 紙本輸出（含兩層聚合與批次展開）

  * 可列印的庫存清單（print-friendly / PDF）
  * 紙本上同一物品在第一層合併，並於第二層將不同批次分項列開（依使用者設定決定顯示/聚合欄位）
  * 紙本版面樣式作為獨立 feature 討論與驗收
* 手機適配

  * 核心流程在手機上可順暢完成（新增、入庫、消耗、盤點、查詢、篩選、列印/下載）

## 6. 核心用例清單（Use Cases）

> 每個用例對應一份 feature 文件；PRD 只列用例，不寫細節。

* UC-01：使用者登入並建立第一個倉庫

  * Spec：docs/features/auth-and-onboarding.md
* UC-02：建立/切換/管理多個倉庫

  * Spec：docs/features/warehouses.md
* UC-03：邀請其他使用者或團體加入倉庫並設定權限（owner/editor/viewer）

  * Spec：docs/features/sharing-and-roles.md
* UC-04：建立與管理團體（成員集合；團體管理者）

  * Spec：docs/features/groups.md
* UC-05：管理採購列表物資（新增/編輯/數量/包裝規格/標籤）

  * Spec：docs/features/purchase-items.md
* UC-06：將採購項目轉為庫存項目（支援部分入庫；建立批次；採購側保留轉出紀錄；一次入庫共享屬性）

  * Spec：docs/features/purchase-to-stock-conversion.md
* UC-07：管理庫存物資（更正錯誤輸入；批次展開與兩層聚合顯示；入庫標籤僅影響該批次）

  * Spec：docs/features/stock-items.md
* UC-08：消耗（出庫）：系統依預設順序分配批次並允許覆寫；產生可追溯交易紀錄

  * Spec：docs/features/consumption-and-adjustments.md
* UC-09：盤點（調整）：手動指定批次並直接指定實際數量；可選備註；產生可追溯交易紀錄

  * Spec：docs/features/consumption-and-adjustments.md
* UC-10：管理倉庫的存放點清單（可改名；可作廢不可刪；有庫存占用不可作廢）

  * Spec：docs/features/storage-locations.md
* UC-11：管理倉庫的標籤字典（可改名/作廢；作廢預設不可篩選；顯示加註）

  * Spec：docs/features/tags-and-categories.md
* UC-12：庫存轉移（修改存放點 ID 以交易方式處理）

  * Spec：docs/features/stock-transfers.md
* UC-13：查看物資總覽並使用篩選條件快速找到需要處理的項目（支援兩層聚合顯示與展開）

  * Spec：docs/features/stock-overview-and-filters.md
* UC-14：設定並使用「滿足單位」做儲備彙總統計（不同包裝可有不同單位量）

  * Spec：docs/features/satisfaction-units.md
* UC-15：到期提醒：依使用者聚合規則決定提醒粒度；到期日空值永不提醒；Email/ICS

  * Spec：docs/features/expiry-notifications.md
* UC-16：輸出紙本庫存清單（兩層聚合；批次分項列出）以供離線盤點使用

  * Spec：docs/features/printable-inventory-sheet.md
* UC-17：在手機上完成快速新增、入庫、消耗、盤點與查詢（手機優先 UX）

  * Spec：docs/features/mobile-ux.md

## 7. 全局驗收（Definition of Done）

* 基本可用性

  * 使用者可登入並建立至少一個倉庫，資料持久化於後端資料庫。
  * 使用者可建立多個倉庫並切換，資料互不混淆。
* 共享與權限

  * 可邀請其他使用者加入指定倉庫。
  * 可將團體加入指定倉庫，且團體內所有成員一體適用該權限。
  * 角色權限生效：MVP 只需 owner/editor/viewer，且至少能區分「可編輯」與「只讀」行為（具體矩陣在 feature 定義）。
* 團體（Group）

  * 可建立團體並管理成員集合。
  * 團體至少一位管理者；管理者可指派更多管理者。
* 採購與庫存管理（含交易追溯）

  * 採購列表可新增/修改物資並包含數量（整數）與可選包裝規格，且與庫存共用同一套類別標籤體系。
  * 採購→入庫可完成且支援部分入庫；採購列表需保留對應的轉出紀錄以供追溯。
  * 庫存列表可新增/修改物資並包含到期日（可選）、存放點（從倉庫存放點字典選擇）、是否開封。
  * 入庫會建立庫存批次；同一物品多批次時，UI 可依「兩層聚合」呈現並展開。
  * 入庫時可更新標籤，但僅影響該次入庫生成的庫存批次（不影響其他批次/採購項目）。
* 數量變動可追溯（不可刪除）

  * 購買（入庫）、消耗（出庫）、盤點（調整）皆會改變數量，且每次變動均有可追溯紀錄（交易/事件）。
  * 交易/事件紀錄不允許刪除；若填錯，使用者可用後續的盤點/調整或其他交易修正（等價沖銷）。
  * 數量規則符合：入庫/採買不允許小數；消耗與盤點允許小數。
* 消耗（出庫）與盤點（調整）行為

  * 消耗：若上下文不足以決定批次，系統依預設順序分配並允許覆寫；扣減對應批次數量並產生交易紀錄。
  * 盤點：必須手動指定批次；以「直接指定實際數量」記錄調整交易；備註可選。
* 物品/批次在 UI 與紙本的呈現

  * UI 與紙本皆支援兩層聚合：第一層依品名、第二層依（包裝規格、到期日、存放點）聚合。
  * 同品名不同包裝規格預設分開；缺少包裝規格者也與有包裝規格者分開。
  * 使用者可設定第二層需要哪些欄位一致才聚合，以及可省略哪些欄位不顯示；且 UI 與紙本可分別設定。
  * 紙本清單同一物品合併，批次分項列出，符合盤點需求。
* 存放點一致性與歷史可追溯

  * 倉庫可維護可重用的存放點清單（具 unique ID 與顯示名稱）。
  * 存放點改名會反映於既有庫存顯示。
  * 存放點可作廢不可刪除；若仍有庫存指向該存放點則不可作廢；作廢後不可再被新庫存選用但可追溯。
  * 若要更動庫存所屬的存放點（ID），需以交易方式處理（例如轉移紀錄），不可直接改 ID。
* 標籤治理與歷史呈現

  * 標籤字典為倉庫範圍；標籤改名會反映於既有紀錄顯示。
  * 標籤可作廢；作廢後不可被新物品選用，且預設不可用於篩選；既有紀錄顯示時需加註「已作廢」。
* 到期提醒語意

  * 到期提醒粒度依使用者當下聚合規則決定：若被聚合為同一項目則一起提醒；否則分開提醒。
  * 到期日為空者永不提醒。
* 總覽與篩選

  * 物資總覽可用篩選條件快速找出快到期項目（依 feature 定義），且在聚合/展開狀態下仍保持可用。
  * 若啟用滿足單位：可在總覽或報表中看到至少「每一種類別的單位總和」與其來源（MVP 先提供彙總；目標值設定留待後續）。
  * 不同包裝規格可有不同滿足單位量，且彙總結果可追溯到各批次/項目。
* 通知（以到期為核心；使用者層級訂閱）

  * Email 到期提醒可選擇啟用並可觸發寄送，具備基本去重/頻率控制（避免 spam）。
  * 可匯出 iCalendar/ICS（完整當前清單），且匯入主流行事曆後能看到到期事件與提前提醒（規則依 feature 定義）。
  * MVP 先只支援「訂閱到倉庫」；到期日與 ICS 事件以使用者時區為準。
* 紙本輸出

  * 可產生可列印版本（或 PDF），資訊完整且適合紙筆勾記（具體版面驗收在 feature 定義）。
* 手機體驗

  * 在常見手機尺寸下，完成新增/入庫/消耗/盤點/查詢/篩選不需水平捲動，主要操作不被遮擋。
* 安全與資料隔離（高層次）

  * 不同倉庫之資料彼此隔離，只有被授權的使用者能讀寫相對應倉庫的資料。

## 8. 後續應建立的 Features 文件清單（Backlog of feature specs）

> 這裡列「應建立的 files」與一句話摘要；細節都在各 feature 文件。

* docs/features/auth-and-onboarding.md

  * 登入方式、初次導覽、建立第一個倉庫的最短路徑。
* docs/features/warehouses.md

  * 倉庫的建立/切換/基本設定。
* docs/features/sharing-and-roles.md

  * 共享流程、邀請方式、角色權限矩陣（固定 owner/editor/viewer；可對使用者或團體授權）與邊界行為。
* docs/features/groups.md

  * 團體（Group）管理：成員集合、團體管理者、以及作為倉庫成員被授權的行為。
* docs/features/storage-locations.md

  * 倉庫層級的存放點字典（新增/改名/作廢）、作廢限制（有庫存占用不可作廢）、與歷史追溯。
* docs/features/tags-and-categories.md

  * 倉庫範圍的標籤字典（改名/作廢規則、作廢後的顯示與預設不可篩選）。
* docs/features/purchase-items.md

  * 採購物資欄位（含整數數量與可選包裝規格）、與庫存共用的標籤/分類策略、增修流程（含採購側轉出紀錄概念）。
* docs/features/purchase-to-stock-conversion.md

  * 採購→入庫的轉換規則與操作流程（含部分入庫、一次入庫共享屬性、批次建立、到期日/存放點一致性、入庫標籤僅影響該批次、採購側保留轉出紀錄）。
* docs/features/consumption-and-adjustments.md

  * 消耗（出庫）與盤點（調整）：消耗的預設批次分配順序與覆寫、盤點需手動指定批次且以實際數量調整、備註可選、以及小數規則。
* docs/features/stock-items.md

  * 庫存物資欄位（到期/存放點/開封/數量/包裝規格/滿足單位等）與更正錯誤輸入的邊界。
* docs/features/stock-batches-and-grouping.md

  * 物品兩層聚合顯示（第一層品名、第二層包裝規格/到期日/存放點可配置）、批次展開、以及 UI/紙本分別設定的規格。
* docs/features/stock-transfers.md

  * 庫存轉移：更動存放點 ID 以交易方式處理（新增轉移紀錄），不可直接改 ID。
* docs/features/stock-overview-and-filters.md

  * 總覽頁資訊架構、篩選/搜尋條件、預設排序與呈現原則（含聚合/展開狀態）。
* docs/features/expiry-notifications.md

  * 到期提醒規則、頻率去重、Email 與 ICS 匯出策略（完整清單匯出；到期日當天事件 + 提前提醒預設策略；只訂閱到倉庫；使用者時區；提醒粒度依聚合規則）。
* docs/features/printable-inventory-sheet.md

  * 紙本清單版型、欄位選擇、紙筆盤點操作設計與驗收（含兩層聚合與批次分項列出）。
* docs/features/mobile-ux.md

  * 手機優先的關鍵流程（快速新增/入庫/消耗/盤點）與可用性標準。
* docs/features/satisfaction-units.md

  * 滿足單位的倉庫層級字典（種類/意涵）、批次層級的單位量、以及總覽如何彙總（MVP 先彙總；目標留待後續）。
* docs/features/audit-and-history.md

  * 變更紀錄/歷史追蹤策略（交易不可刪除、以後續交易修正/沖銷、以及查詢呈現），作為後續擴充基礎。
* docs/features/data-export-and-retention.md

  * 匯出資料（CSV/JSON）與資料保留/刪除政策（MVP 可選）。

## 9. 仍待釐清（Questions to Confirm）

* （目前無）
